@using PoC1_LegacyAnalyzer_Web.Components.Shared
@using PoC1_LegacyAnalyzer_Web.Models.MultiAgent
@using PoC1_LegacyAnalyzer_Web.Helpers

@* Individual agent analysis display card *@
<div class="agent-result-card mb-4">
    <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
            <h6 class="text-primary mb-1">
                @GetAgentIcon(Analysis.AgentName) @Analysis.AgentName
            </h6>
            <small class="text-muted">@Analysis.Specialty</small>
        </div>
        <div class="text-end">
            <BadgeWithIcon 
                Text="@($"{Analysis.ConfidenceScore}% Confidence")"
                Color="@GetConfidenceColor(Analysis.ConfidenceScore)"
                Size="fs-6" />
            <br>
            <small class="text-muted">@Analysis.Priority Priority</small>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <strong>Key Findings (@(Analysis.KeyFindings?.Count ?? 0)):</strong>
            @if (Analysis.KeyFindings?.Any() == true)
            {
                <ul class="list-unstyled mt-2">
                    @foreach (var finding in Analysis.KeyFindings.Take(5))
                    {
                        <li class="mb-1">
                            <BadgeWithIcon 
                                Text="@finding.Severity"
                                Color="@GetSeverityColor(finding.Severity)" />
                            <strong>@finding.Category:</strong> @finding.Description
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted mt-2"><small>No findings reported</small></p>
            }
        </div>
        <div class="col-md-6">
            <strong>Recommendations (@(Analysis.Recommendations?.Count ?? 0)):</strong>
            @if (Analysis.Recommendations?.Any() == true)
            {
                <ul class="list-unstyled mt-2">
                    @foreach (var rec in Analysis.Recommendations.Take(3))
                    {
                        <li class="mb-2">
                            <strong>@rec.Title</strong><br>
                            <small class="text-muted">Priority: @rec.Priority | Effort: @rec.EstimatedHours hours</small>
                            @if (!string.IsNullOrWhiteSpace(rec.Description))
                            {
                                <br><small class="text-muted">@rec.Description</small>
                            }
                        </li>
                    }
                </ul>
            }
            else
            {
                <p class="text-muted mt-2"><small>No recommendations provided</small></p>
            }
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Analysis.BusinessImpact))
    {
        <div class="mt-3 p-3 bg-light rounded">
            <strong>Business Impact:</strong><br>
            <small>@Analysis.BusinessImpact</small>
        </div>
    }
</div>

@code {
    [Parameter] public SpecialistAnalysisResult Analysis { get; set; } = null!;

    private string GetAgentIcon(string agentName)
    {
        return agentName.ToLower() switch
        {
            var name when name.Contains("security") => "???",
            var name when name.Contains("performance") => "?",
            var name when name.Contains("architectural") || name.Contains("architecture") => "???",
            _ => "??"
        };
    }

    private string GetConfidenceColor(int confidence)
    {
        return confidence switch
        {
            >= 90 => "success",
            >= 75 => "primary",
            >= 60 => "warning",
            _ => "danger"
        };
    }

    private string GetSeverityColor(string severity)
    {
        return severity?.ToUpper() switch
        {
            "CRITICAL" => "danger",
            "HIGH" => "warning",
            "MEDIUM" => "info",
            "LOW" => "secondary",
            _ => "light"
        };
    }
}

<style>
    .agent-result-card {
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 1.5rem;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .agent-result-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
</style>