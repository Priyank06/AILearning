@using PoC1_LegacyAnalyzer_Web.Helpers

@* Implementation strategy section component *@
@if (!string.IsNullOrEmpty(Strategy))
{
    <div class="mt-4">
        <div class="card">
            <div class="card-header bg-light" style="cursor: pointer;" @onclick="OnToggle">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="bi bi-map"></i> Implementation Strategy
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi @(IsExpanded ? "bi-chevron-up" : "bi-chevron-down")"></i>
                    </button>
                </div>
            </div>
            @if (IsExpanded)
            {
                <div class="card-body">
                    <div class="p-3 bg-light rounded">
                        @((MarkupString)FormatImplementationStrategy(Strategy))
                    </div>
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter] public string? Strategy { get; set; }
    [Parameter] public bool IsExpanded { get; set; }
    [Parameter] public EventCallback OnToggle { get; set; }

    private string FormatImplementationStrategy(string strategy)
    {
        if (string.IsNullOrEmpty(strategy)) return "";

        // Format phases and sections
        strategy = strategy.Replace("Phase 1:", "<h6 class='text-secondary mt-3 mb-2'><i class='bi bi-1-circle'></i> Phase 1:</h6>");
        strategy = strategy.Replace("Phase 2:", "<h6 class='text-secondary mt-3 mb-2'><i class='bi bi-2-circle'></i> Phase 2:</h6>");
        strategy = strategy.Replace("Phase 3:", "<h6 class='text-secondary mt-3 mb-2'><i class='bi bi-3-circle'></i> Phase 3:</h6>");

        strategy = strategy.Replace("\n\n", "</p><p>");
        strategy = strategy.Replace("\n", "<br>");
        strategy = strategy.Replace("ï¿½ ", "<i class='bi bi-check-circle text-success me-1'></i>");

        if (!strategy.StartsWith("<h6") && !strategy.StartsWith("<p"))
        {
            strategy = $"<p>{strategy}</p>";
        }

        return strategy;
    }
}